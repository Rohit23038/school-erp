<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
</head>
<body>

<h2>Admin Dashboard</h2>

<hr>

<h3>Add / Update Student</h3>

<p>
  UID (Auth UID):
  <input id="uid" placeholder="Student UID">
</p>

<p>
  Name:
  <input id="name">
</p>

<p>
  Class:
  <input id="class">
</p>

<p>
  Roll:
  <input id="roll">
</p>

<p>
  Total Fee:
  <input id="totalFee" type="number">
</p>

<p>
  Paid Fee:
  <input id="paidFee" type="number">
</p>

<p>
  Attendance (%):
  <input id="attendance" type="number">
</p>

<button onclick="saveStudent()">Save / Update Student</button>

<hr>

<h3>Delete Student</h3>
<input id="deleteUid" placeholder="Student UID">
<button onclick="deleteStudent()">Delete</button>

<hr>

<button onclick="logout()">Logout</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
  import {
    getFirestore,
    doc,
    setDoc,
    deleteDoc
  } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAw6mNbrIILP9fNNSzAXuPEUsN7x3T0dsY",
    authDomain: "schoolerp-cb790.firebaseapp.com",
    projectId: "schoolerp-cb790",
    storageBucket: "schoolerp-cb790.firebasestorage.app",
    messagingSenderId: "1098794553484",
    appId: "1:1098794553484:web:b8d2abe9b829f8fa7d2ba9"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ðŸ” Admin login check
  onAuthStateChanged(auth, (user) => {
    if (!user) {
      window.location.href = "login.html";
    }
  });

  // âž• Add / Update student
  window.saveStudent = async function () {
    const uid = uidInput();
    if (!uid) return alert("UID required");

    await setDoc(
      doc(db, "schools", "school1", "students", uid),
      {
        name: value("name"),
        class: value("class"),
        roll: value("roll"),
        totalFee: Number(value("totalFee")),
        paidFee: Number(value("paidFee")),
        attendance: Number(value("attendance"))
      }
    );

    alert("Student saved / updated");
  };

  // âŒ Delete student
  window.deleteStudent = async function () {
    const uid = document.getElementById("deleteUid").value;
    if (!uid) return alert("UID required");

    await deleteDoc(
      doc(db, "schools", "school1", "students", uid)
    );

    alert("Student deleted");
  };

  // ðŸšª Logout
  window.logout = function () {
    signOut(auth).then(() => {
      window.location.href = "login.html";
    });
  };

  // helpers
  function value(id) {
    return document.getElementById(id).value;
  }
  function uidInput() {
    return document.getElementById("uid").value;
  }
</script>

</body>
</html>
