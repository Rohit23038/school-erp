<!DOCTYPE html>
<html>
<head>
  <title>New Student Registration</title>
</head>
<body>

<h2>New Student Registration</h2>

<form id="registerForm">
  <p>Name: <input type="text" id="name" required></p>
  <p>Class: <input type="text" id="class" required></p>
  <p>Email: <input type="email" id="email" required></p>
  <p>Password: <input type="password" id="password" required></p>
  <p>Mobile: <input type="text" id="mobile" required></p>

  <hr>

  <h3>Fees Payment</h3>
  <p><b>Fees Amount:</b> â‚¹12000</p>
  <p><b>UPI ID:</b> sarojkumari4440@nyes</p>

  <button type="button" onclick="generateQR()">Generate UPI QR</button><br><br>

  <img id="upiQR" width="200"><br><br>

  <p>Transaction ID: <input type="text" id="txnId" required></p>

  <button type="submit">Register & Generate Receipt</button>
</form>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword } from
    "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
  import { getFirestore, doc, setDoc } from
    "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAw6mNbrIILP9fNNSzAXuPEUsN7x3T0dsY",
    authDomain: "schoolerp-cb790.firebaseapp.com",
    projectId: "schoolerp-cb790",
    storageBucket: "schoolerp-cb790.appspot.com",
    messagingSenderId: "1098794553484",
    appId: "1:1098794553484:web:b8d2abe9b829f8fa7d2ba9"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  document.getElementById("registerForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const name = nameInput.value;
    const cls = classInput.value;
    const email = emailInput.value;
    const password = passwordInput.value;
    const mobile = mobileInput.value;
    const txnId = txnIdInput.value;

    try {
      const userCred = await createUserWithEmailAndPassword(auth, email, password);
      const uid = userCred.user.uid;

      await setDoc(doc(db, "schools", "school1", "students", uid), {
        name: name,
        class: cls,
        mobile: mobile,
        totalFee: 12000,
        paidFee: 12000,
        attendance: 0,
        txnId: txnId,
        createdAt: new Date()
      });

      window.location.href =
        `receipt.html?name=${name}&class=${cls}&amount=12000&txn=${txnId}`;

    } catch (err) {
      alert(err.message);
    }
  });

  // expose inputs
  const nameInput = document.getElementById("name");
  const classInput = document.getElementById("class");
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const mobileInput = document.getElementById("mobile");
  const txnIdInput = document.getElementById("txnId");
</script>

<script>
  function generateQR() {
    const upi = "sarojkumari4440@nyes";
    const amount = "12000";

    document.getElementById("upiQR").src =
      `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=${upi}&am=${amount}&cu=INR`;
  }
</script>

</body>
</html>
