<!DOCTYPE html>
<html>
<head>
  <title>Student Registration</title>
</head>
<body>

<h2>New Student Registration</h2>

<p>Name: <input id="name"></p>
<p>Class: <input id="class"></p>
<p>Email: <input id="email"></p>
<p>Password: <input id="password" type="password"></p>
<p>Mobile: <input id="mobile"></p>

<hr>

<h3>Fees Payment</h3>
<p>Fees Amount: â‚¹<b>12000</b></p>
<p>UPI ID: <b>school@upi</b></p>

<p>Transaction ID: <input id="txn"></p>

<button onclick="register()">Register & Generate Receipt</button>

<p id="msg"></p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAw6mNbrIILP9fNNSzAXuPEUsN7x3T0dsY",
  authDomain: "schoolerp-cb790.firebaseapp.com",
  projectId: "schoolerp-cb790"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.register = async function () {
  try {
    const cred = await createUserWithEmailAndPassword(
      auth,
      email.value,
      password.value
    );

    const uid = cred.user.uid;

    await setDoc(doc(db,"schools","school1","students",uid),{
      name: name.value,
      class: class.value,
      mobile: mobile.value,
      totalFee: 12000,
      paidFee: 12000,
      attendance: 0
    });

    await setDoc(doc(db,"schools","school1","users",uid),{
      role: "student"
    });

    await setDoc(doc(db,"schools","school1","receipts",uid),{
      name: name.value,
      class: class.value,
      amount: 12000,
      txn: txn.value,
      date: new Date().toLocaleString()
    });

    window.location.href = "receipt.html?uid=" + uid;

  } catch(e){
    msg.innerText = e.message;
  }
}
</script>

</body>
</html>
