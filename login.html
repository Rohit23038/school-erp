<script type="module">
  import { auth } from "./firebase.js";
  import { signInWithEmailAndPassword } 
    from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
  import { getFirestore, doc, getDoc } 
    from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
  import { app } from "./firebase.js";

  const db = getFirestore(app);

  const email = document.getElementById("email");
  const password = document.getElementById("password");
  const msg = document.getElementById("msg");

  document.getElementById("loginBtn").onclick = async () => {
    try {
      const userCred = await signInWithEmailAndPassword(
        auth,
        email.value,
        password.value
      );

      const uid = userCred.user.uid;

      // ðŸ”¹ Firestore se role lao
      const ref = doc(db, "schools", "school1", "users", uid);
      const snap = await getDoc(ref);

      if (!snap.exists()) {
        msg.innerText = "User role not found";
        return;
      }

      const role = snap.data().role;

      // ðŸ”¹ Role based redirect
      if (role === "admin") {
        window.location.href = "index.html";
      } else if (role === "teacher") {
        window.location.href = "index.html";
      } else if (role === "student") {
        window.location.href = "index.html";
      } else {
        msg.innerText = "Invalid role";
      }

    } catch (e) {
      msg.innerText = e.message;
    }
  };
</script>
